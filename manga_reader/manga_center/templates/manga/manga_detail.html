{% extends "base.html" %}
{% block title %}{{ manga.title }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-4">
        {% if manga.cover_image %}
        <img src="{{ url_for('static', filename='manga_covers/' ~ manga.cover_image) }}" class="img-fluid"
            alt="{{ manga.title }}">
        {% else %}
        <div class="bg-secondary text-white p-5 text-center">No Cover</div>
        {% endif %}
    </div>

    <div class="col-md-8">
        <h2>{{ manga.title }}</h2>
        <p>{{ manga.description or '' }}</p>

        <div class="mb-3">
            {% if current_user.is_authenticated %}
            <a href="{{ url_for('bookmark.toggle_bookmark', manga_id=manga.id) }}"
                class="btn btn-outline-danger btn-sm">
                {% if current_user.bookmarks|map(attribute='manga_id')|list | contains(manga.id) %}Remove Bookmark{%
                else %}Bookmark{% endif %}
            </a>
            {% endif %}

            {% if current_user.is_authenticated and (current_user.is_studio() or current_user.is_admin()) and
            manga.studio_id == current_user.id %}
            <a href="{{ url_for('studio.add_chapter', manga_id=manga.id) }}" class="btn btn-success btn-sm">Add
                Chapter</a>
            {% endif %}
        </div>

        <h5>Chapters</h5>
        {% if chapters %}
        <ul class="list-group">
            {% for ch in chapters %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <strong>Chapter {{ ch.number }}</strong>
                    {% if ch.title %} â€” {{ ch.title }}{% endif %}
                </div>
                <div>
                    <a href="{{ url_for('manga.read_chapter', manga_id=manga.id, chapter_id=ch.id) }}"
                        class="btn btn-primary btn-sm">Read</a>
                    {% if current_user.is_authenticated and (current_user.is_studio() or current_user.is_admin()) and
                    manga.studio_id == current_user.id %}
                    <a href="{{ url_for('studio.edit_chapter', chapter_id=ch.id) }}"
                        class="btn btn-sm btn-warning">Edit</a>
                    {% endif %}
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>No chapters yet.</p>
        {% endif %}
    </div>
</div>
{% endblock %}