{% extends "base.html" %}
{% block title %}Edit Chapter - {{ chapter.title }}{% endblock %}

{% block content %}
<section class="edit-chapter">
    <h2>Edit Chapter: {{ chapter.title }}</h2>

    <form method="post" enctype="multipart/form-data">
        {{ form.hidden_tag() }}

        <div>
            {{ form.title.label }}<br>
            {{ form.title(class="form-control", value=chapter.title) }}
        </div>

        <div>
            {{ form.number.label }}<br>
            {{ form.number(class="form-control", value=chapter.number) }}
        </div>

        <div>
            <label>Current Images:</label>
            <div style="display: flex; flex-wrap: wrap;">
                {% set chapter_folder = url_for('static', filename=os.path.relpath(chapter.content_path,
                'static').replace('\\', '/')) %}
                {% for img in os.listdir(os.path.join(current_app.root_path, chapter.content_path)) if
                img.lower().endswith('.png', '.jpg', '.jpeg', '.gif', '.webp') %}
                <img src="{{ url_for('static', filename=os.path.relpath(os.path.join(chapter.content_path, img), 'static').replace('\\', '/')) }}"
                    alt="{{ img }}" style="max-height: 150px; margin: 5px;">
                {% endfor %}
            </div>
        </div>

        <div>
            {{ form.images.label }}<br>
            {{ form.images(class="form-control", multiple=True) }}
            <small>Upload new images to replace old ones.</small>
        </div>

        <button type="submit">Update Chapter</button>

    </form>

    <form method="post" action="{{ url_for('author.delete_chapter', chapter_id=chapter.id) }}"
        onsubmit="return confirm('Are you sure you want to delete this chapter?');">
        <button type="submit" style="margin-top: 15px; background-color: red; color: white;">Delete</button>
    </form>

    <div style="margin-top: 15px;">
        <a href="{{ url_for('author.view_chapters', manga_id=manga.id) }}">Back to Chapters</a>
    </div>
</section>
{% endblock %}