{% extends "base.html" %}
{% block title %}All Manga{% endblock %}

{% block content %}
<section class="manga-list">
    <h2>All Manga</h2>

    <!-- ðŸ” Search + Filter Form -->
    <form method="get" action="{{ url_for('public.all_manga') }}" style="margin-bottom: 20px;">
        <input type="text" name="search" placeholder="Search manga by title..." value="{{ search_query }}"
            style="padding: 8px;">
        <select name="author" style="padding: 8px;">
            <option value="">All Authors</option>
            {% for author in authors %}
            <option value="{{ author.pen_name or author.user.username }}" {% if author_filter==(author.pen_name or
                author.user.username) %}selected{% endif %}>
                {{ author.pen_name or author.user.username }}
            </option>
            {% endfor %}
        </select>
        <button type="submit" style="padding: 8px;">Search</button>
    </form>

    <!-- ðŸ§¾ Manga Results -->
    {% if mangas %}
    <div style="display: flex; flex-wrap: wrap; gap: 20px;">
        {% for manga in mangas %}
        <div style="border: 1px solid #ccc; border-radius: 10px; padding: 10px; width: 200px; text-align: center;">
            <a href="{{ url_for('public.view_manga', manga_id=manga.id) }}">
                <img src="{{ manga.cover_url }}" alt="{{ manga.title }}" style="max-width: 100%; border-radius: 5px;">
            </a>
            <h3>{{ manga.title }}</h3>
            <p><small>by
                    <a href="{{ url_for('public.view_author', author_id=manga.author.id) }}">
                        {{ manga.author.pen_name or manga.author.user.username }}
                    </a>
                </small></p>
            <p>{{ manga.description[:80] }}{% if manga.description|length > 80 %}...{% endif %}</p>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>No manga found matching your search or filter.</p>
    {% endif %}

    <!-- ðŸ“„ Pagination Controls -->
    {% if pagination.pages > 1 %}
    <div style="text-align:center; margin-top:20px;">
        {% if pagination.has_prev %}
        <a
            href="{{ url_for('public.all_manga', page=pagination.prev_num, search=search_query, author=author_filter) }}">&laquo;
            Prev</a>
        {% endif %}

        {% for p in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
        {% if p %}
        {% if p == pagination.page %}
        <strong>[{{ p }}]</strong>
        {% else %}
        <a href="{{ url_for('public.all_manga', page=p, search=search_query, author=author_filter) }}">{{ p }}</a>
        {% endif %}
        {% else %}
        ...
        {% endif %}
        {% endfor %}

        {% if pagination.has_next %}
        <a
            href="{{ url_for('public.all_manga', page=pagination.next_num, search=search_query, author=author_filter) }}">Next
            &raquo;</a>
        {% endif %}
    </div>
    {% endif %}
</section>
{% endblock %}