{% extends "base.html" %}
{% block title %}Manga Center - Home{% endblock %}

{% block content %}
<div class="container my-4">
    <h2 class="mb-4 text-center">ðŸ“š Latest Updated Mangas</h2>

    {% if mangas %}
    <div class="row g-4">
        {% for manga in mangas %}
        <div class="col-6 col-md-3">
            <div class="card h-100 shadow-sm border-0">
                <a href="{{ url_for('public.view_manga', manga_id=manga.id) }}" class="text-decoration-none text-dark">
                    <img src="{{ manga.cover_url }}" class="card-img-top" alt="{{ manga.title }}">
                </a>

                <div class="card-body p-2">

                    <!-- Title -->
                    <h6 class="card-title text-center text-truncate mb-1">
                        <a href="{{ url_for('public.view_manga', manga_id=manga.id) }}"
                            class="text-decoration-none text-dark fw-bold">
                            {{ manga.title }}
                        </a>
                    </h6>

                    {% set sorted_chapters = manga.chapters | sort(attribute='upload_date') %}
                    {% set latest_two = sorted_chapters[-2:] %}
                    {% set latest_two = latest_two | reverse %}

                    {% if latest_two %}
                    {% for ch in latest_two %}
                    <div class="text-center mb-1">
                        <a href="{{ url_for('public.read_chapter', manga_id=manga.id, chapter_id=ch.id) }}"
                            class="text-decoration-none fw-semibold" style="font-size: 0.80rem; color:#007bff;">
                            {{ ch.title or ("Chapter " ~ ch.number) }} - <small class="text-muted"
                                style="font-size: 0.70rem;">
                                {{ ch.upload_date | timeago }}
                            </small>
                        </a>
                        <div>

                        </div>
                    </div>
                    {% endfor %}
                    {% else %}
                    <p class="text-center text-muted small">No chapters yet</p>
                    {% endif %}

                </div>

            </div>


        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    <nav class="mt-4 d-flex justify-content-center">
        <ul class="pagination">
            {% if pagination.has_prev %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('public.index', page=pagination.prev_num) }}">&laquo; Prev</a>
            </li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">&laquo; Prev</span></li>
            {% endif %}

            {% for p in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
            {% if p %}
            {% if p == pagination.page %}
            <li class="page-item active"><span class="page-link">{{ p }}</span></li>
            {% else %}
            <li class="page-item"><a class="page-link" href="{{ url_for('public.index', page=p) }}">{{ p }}</a></li>
            {% endif %}
            {% else %}
            <li class="page-item disabled"><span class="page-link">â€¦</span></li>
            {% endif %}
            {% endfor %}

            {% if pagination.has_next %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('public.index', page=pagination.next_num) }}">Next &raquo;</a>
            </li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">Next &raquo;</span></li>
            {% endif %}
        </ul>
    </nav>

    {% else %}
    <p class="text-center text-muted">No manga available yet.</p>
    {% endif %}
</div>
{% endblock %}